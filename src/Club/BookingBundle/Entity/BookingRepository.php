<?php

namespace Club\BookingBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * BookingRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class BookingRepository extends EntityRepository
{
  public function getAllBetween(\DateTime $start, \DateTime $end, \Club\BookingBundle\Entity\Field $field)
  {
    return $this->_em->createQueryBuilder()
      ->select('b')
      ->from('ClubBookingBundle:Booking','b')
      ->where('b.start_date >= :start')
      ->andWhere('b.start_date < :end')
      ->orderBy('b.start_date')
      ->setParameter('start', $start->format('Y-m-d H:i:s'))
      ->setParameter('end', $end->format('Y-m-d H:i:s'))
      ->leftJoin('b.field', 'f')
      ->andWhere('f.id = :field')
      ->setParameter('field', $field->getId())
      ->getQuery()
      ->getResult();
  }

  public function getAllByLocationDate(\Club\UserBundle\Entity\Location $location, \DateTime $date)
  {
    return $this->_em->createQueryBuilder()
      ->select('b')
      ->from('ClubBookingBundle:Booking', 'b')
      ->leftJoin('b.field', 'f')
      ->leftJoin('f.location', 'l')
      ->where('l.id = :location')
      ->andWhere('b.start_date BETWEEN :start AND :stop')
      ->setParameter('location', $location->getId())
      ->setParameter('start', $date->format('Y-m-d 00:00:00'))
      ->setParameter('stop', $date->format('Y-m-d 23:59:59'))
      ->getQuery()
      ->getResult();
  }

  public function getIntervals(\Club\BookingBundle\Entity\Booking $booking)
  {
  }
}
